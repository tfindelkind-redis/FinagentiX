# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: finagentix
metadata:
  template: finagentix@0.0.1-beta

# Services can be deployed independently or all together
services:
  # Stage 0: Foundation - Networking and Shared Resources
  foundation:
    project: ./infra/stages
    language: bicep
    host: azd
    module: stage0-foundation

  # Stage 1: Data Platform - Redis + Storage
  data-platform:
    project: ./infra/stages
    language: bicep
    host: azd
    module: stage1-data-platform

  # Stage 2: AI Services - Azure OpenAI
  ai-services:
    project: ./infra/stages
    language: bicep
    host: azd
    module: stage2-ai-services

  # Stage 3: Data Ingestion - Container App for batch data load
  data-ingestion:
    project: ./infra/stages
    language: bicep
    host: azd
    module: stage3-data-ingestion

  # Stage 4: Agent Runtime - Container App for agents/API
  agent-runtime:
    project: ./infra/stages
    language: bicep
    host: azd
    module: stage4-agent-runtime

# Hooks for custom deployment steps
hooks:
  postprovision:
    posix:
      shell: sh
      run: |
        echo "Infrastructure provisioned successfully!"
        echo "Redis Host: $(azd env get-values | grep REDIS_HOST)"
    windows:
      shell: pwsh
      run: |
        Write-Host "Infrastructure provisioned successfully!"
